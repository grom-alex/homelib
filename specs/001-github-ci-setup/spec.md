# Feature Specification: Настройка GitHub CI/CD и GitHub Flow

**Feature Branch**: `001-github-ci-setup`
**Created**: 2026-02-15
**Status**: Draft
**Input**: User description: "Подключиться к репозиторию git@github.com:grom-alex/homelib.git, настроить GitHub Actions воркфлоу для сборки, тестирования и линтеров. Добавить в конституцию и CLAUDE.md парадигму GitHub Flow."

## User Scenarios & Testing *(mandatory)*

### User Story 1 - Автоматическая проверка PR (Priority: P1)

Разработчик создаёт Pull Request из feature-ветки в `master`. GitHub Actions автоматически запускает пайплайн проверки: сборка Go-бэкенда, запуск тестов, проверка линтерами. Результат отображается в интерфейсе PR — разработчик видит, прошли ли проверки, до мержа.

**Why this priority**: Это основа CI/CD — без автоматических проверок невозможно гарантировать качество кода при вливании в master.

**Independent Test**: Можно протестировать, создав PR с корректным и некорректным Go-кодом — пайплайн должен пройти для первого и упасть для второго.

**Acceptance Scenarios**:

1. **Given** PR создан из feature-ветки в master, **When** пайплайн завершён, **Then** результат (pass/fail) отображается в интерфейсе PR как статус-чек.
2. **Given** Go-код в PR содержит ошибку компиляции, **When** пайплайн запускается, **Then** этап сборки завершается с ошибкой и PR помечается как failed.
3. **Given** Go-код в PR нарушает правила линтера, **When** пайплайн запускается, **Then** этап линтинга завершается с ошибкой и детали отображаются в логе.

---

### User Story 2 - Проверка при пуше в feature-ветку (Priority: P2)

Разработчик пушит код в feature-ветку. GitHub Actions запускает тот же пайплайн проверки, что и при PR, чтобы разработчик получил обратную связь ещё до создания PR.

**Why this priority**: Раннее обнаружение проблем ускоряет цикл разработки.

**Independent Test**: Запушить коммит с ошибкой в feature-ветку — пайплайн должен упасть и результат должен быть виден на вкладке Actions.

**Acceptance Scenarios**:

1. **Given** коммит запушен в feature-ветку, **When** пайплайн завершён, **Then** результат виден на вкладке Actions репозитория.
2. **Given** тесты Go-кода проваливаются, **When** пайплайн запускается, **Then** этап тестов завершается с ошибкой и вывод тестов доступен в логах.

---

### User Story 3 - Защита ветки master (Priority: P3)

Администратор репозитория настраивает branch protection rules для `master`, чтобы вливание кода без прохождения CI было невозможно.

**Why this priority**: Дополняет автоматические проверки организационной защитой — не позволяет обойти CI.

**Independent Test**: Попытаться замержить PR с проваленным CI — GitHub должен заблокировать мерж.

**Acceptance Scenarios**:

1. **Given** branch protection включён для master, **When** PR имеет статус failed CI, **Then** кнопка Merge заблокирована.
2. **Given** branch protection включён для master, **When** PR имеет статус passed CI, **Then** кнопка Merge доступна.

---

### Edge Cases

- Что происходит, если в репозитории ещё нет Go-кода? Пайплайн должен корректно обрабатывать пустой проект (этапы сборки и тестов пропускаются или завершаются успешно).
- Что происходит при таймауте пайплайна? GitHub Actions имеет стандартный таймаут; для данного проекта 15 минут достаточно.
- Что происходит, если фронтенд (Vue 3) ещё не создан? Пайплайн для фронтенда должен пропускаться или не включаться до появления кода.

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: Система CI ДОЛЖНА автоматически запускать пайплайн при создании или обновлении Pull Request в `master`.
- **FR-002**: Система CI ДОЛЖНА автоматически запускать пайплайн при пуше в любую ветку, кроме `master`.
- **FR-003**: Пайплайн Go-бэкенда ДОЛЖЕН включать этапы: сборка (`go build`), тестирование (`go test`), линтинг (`golangci-lint`).
- **FR-004**: Пайплайн ДОЛЖЕН отображать результат каждого этапа отдельно (сборка, тесты, линтинг) — чтобы разработчик видел, на каком этапе произошёл сбой.
- **FR-005**: Результат пайплайна ДОЛЖЕН быть виден как status check в интерфейсе PR.
- **FR-006**: Ветка `master` ДОЛЖНА быть защищена branch protection rule, требующим прохождения CI.
- **FR-007**: Пайплайн ДОЛЖЕН корректно работать на этапе, когда Go-код ещё не создан (graceful skip или успешное завершение).

### Key Entities

- **CI Workflow**: Конфигурация GitHub Actions, определяющая этапы сборки, тестирования и линтинга для Go-бэкенда.
- **Branch Protection Rule**: Набор правил GitHub, запрещающих мерж в master без прохождения проверок.

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: Каждый Pull Request в master автоматически получает результат CI-проверки в течение 10 минут.
- **SC-002**: Разработчик может определить причину сбоя CI (сборка, тест или линтер) без дополнительных инструментов — по логам в интерфейсе GitHub.
- **SC-003**: Невозможно замержить PR в master при проваленном CI (branch protection).
- **SC-004**: Пайплайн не ломается при отсутствии Go-кода или фронтенд-кода в репозитории.

## Assumptions

- Репозиторий `git@github.com:grom-alex/homelib.git` уже создан и доступен.
- На машине разработчика настроены `git` и `gh` CLI.
- GitHub Actions включён для репозитория (по умолчанию включён для всех репозиториев).
- Для линтинга Go используется `golangci-lint` — стандарт де-факто для Go-проектов.
- Пайплайн для фронтенда (Vue 3) будет добавлен позже, когда появится фронтенд-код.
- Конституция проекта и CLAUDE.md уже обновлены (GitHub Flow) как часть этой фичи.
