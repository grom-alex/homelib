# Quickstart: Верификация читалки FB2

**Feature**: 006-fb2-reader | **Date**: 2026-02-18

## Предусловия

- Docker Compose dev-окружение запущено (`make dev`)
- Зарегистрирован пользователь, выполнен вход
- В каталоге есть книги в формате FB2 (импортирована INPX с FB2-книгами)

---

## Сценарий 1: Открытие и чтение книги (US1 — P1)

### Шаг 1. Найти FB2-книгу в каталоге

1. Перейти на `/books`
2. Найти книгу с форматом `fb2` (через поиск или фильтры)
3. **Ожидание**: на карточке книги отображается кнопка «Читать»

### Шаг 2. Открыть книгу в читалке

1. Нажать кнопку «Читать»
2. **Ожидание**: открылась страница `/books/:id/read`
3. **Ожидание**: текст книги отображается с корректной типографикой (красная строка, шрифт Georgia, выравнивание по ширине)
4. **Ожидание**: время загрузки < 3 сек

### Шаг 3. Перелистывание страниц

1. Нажать `→` (стрелка вправо) — перелистнуть вперёд
2. Нажать `←` (стрелка влево) — перелистнуть назад
3. Нажать `Space` — перелистнуть вперёд
4. **Ожидание**: текст плавно переключается между страницами

### Шаг 4. Оглавление

1. Нажать кнопку оглавления (или клавишу `T`)
2. **Ожидание**: появилась боковая панель с иерархическим списком глав
3. Нажать на любую главу
4. **Ожидание**: текст переключился на выбранную главу

### Шаг 5. Специальные элементы FB2

1. Найти в книге эпиграф → **курсив с отступом**
2. Найти стихотворение → **построчное форматирование**
3. Найти цитату → **отступ с боковой линией**
4. Найти встроенное изображение → **отображается пропорционально**

---

## Сценарий 2: Сохранение и восстановление прогресса (US2 — P2)

### Шаг 1. Прочитать несколько страниц

1. Открыть книгу в читалке
2. Перелистнуть 5-10 страниц вперёд
3. Запомнить текущую главу и примерную позицию

### Шаг 2. Закрыть и снова открыть

1. Закрыть вкладку браузера
2. Открыть книгу снова (через каталог → «Читать»)
3. **Ожидание**: читалка открылась на последней сохранённой позиции (той же главе)

### Шаг 3. Индикатор прогресса

1. Перейти в каталог `/books`
2. Найти карточку книги, которую уже начали читать
3. **Ожидание**: на карточке отображается процент прочитанного

---

## Сценарий 3: Настройки читалки (US3 — P3)

### Шаг 1. Изменить шрифт

1. Открыть книгу в читалке
2. Открыть панель настроек (иконка ⚙ или аналогичная)
3. Изменить размер шрифта (увеличить до 24px)
4. **Ожидание**: текст мгновенно перестроился с новым размером

### Шаг 2. Переключить тему

1. Выбрать тему «Тёмная»
2. **Ожидание**: фон стал тёмным, текст светлым
3. Выбрать тему «Сепия»
4. **Ожидание**: фон стал кремовым, текст коричневатым

### Шаг 3. Настроить интервалы

1. Изменить межстрочный интервал (увеличить до 2.0)
2. Изменить горизонтальные поля (увеличить до 15%)
3. **Ожидание**: текст перестроился без потери текущей позиции

### Шаг 4. Сохранение настроек

1. Закрыть книгу
2. Открыть **другую** книгу
3. **Ожидание**: все ранее изменённые настройки (шрифт, тема, интервалы) сохранены

---

## Сценарий 4: Edge Cases

### 4.1. Неподдерживаемый формат

1. Найти книгу в формате `epub` или `pdf`
2. **Ожидание**: кнопка «Читать» **не отображается**, но кнопка «Скачать» доступна

### 4.2. Книга без оглавления

1. Открыть книгу с одной секцией (без вложенных `<section>`)
2. **Ожидание**: читалка работает, оглавление или пустое, или с одним пунктом

### 4.3. Мобильное устройство

1. Открыть книгу на мобильном (или через DevTools → Toggle Device)
2. Свайп влево → следующая страница
3. Свайп вправо → предыдущая страница
4. Тап по центру → показать/скрыть панели
5. **Ожидание**: навигация жестами работает корректно

---

## API-верификация (curl)

```bash
# Получить токен
TOKEN=$(curl -s -X POST http://localhost:8080/api/auth/login \
  -H 'Content-Type: application/json' \
  -d '{"login":"user@test.com","password":"password"}' | jq -r '.accessToken')

# Получить контент книги (подставить реальный ID)
curl -s http://localhost:8080/api/books/1/content \
  -H "Authorization: Bearer $TOKEN" | jq .

# Получить главу
curl -s http://localhost:8080/api/books/1/chapter/ch1 \
  -H "Authorization: Bearer $TOKEN" | jq .

# Сохранить прогресс
curl -s -X PUT http://localhost:8080/api/me/books/1/progress \
  -H "Authorization: Bearer $TOKEN" \
  -H 'Content-Type: application/json' \
  -d '{"chapterId":"ch1-3","chapterProgress":50,"totalProgress":10,"device":"desktop"}'

# Получить прогресс
curl -s http://localhost:8080/api/me/books/1/progress \
  -H "Authorization: Bearer $TOKEN" | jq .

# Получить настройки
curl -s http://localhost:8080/api/me/settings \
  -H "Authorization: Bearer $TOKEN" | jq .

# Обновить настройки читалки
curl -s -X PUT http://localhost:8080/api/me/settings \
  -H "Authorization: Bearer $TOKEN" \
  -H 'Content-Type: application/json' \
  -d '{"reader":{"fontSize":20,"theme":"dark"}}'
```
